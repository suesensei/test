wrongSound.play().catch(() => {}); wrongCount++; ball.active = false; }
              return true;
            }
            return false;
          });
        }
      }
      if (gameOver) drawGameOver(); else requestAnimationFrame(loop);
    }

    function startGame() {
      document.getElementById('startScreen').style.display='none';
      resizeCanvas(); initClouds(); initSounds(); loadStage(); requestAnimationFrame(loop);
    }
    document.getElementById('startButton').addEventListener('click', startGame);

    // イベント (pointer & touch)
    let isDragging=false, startOnShip=false;
    function handleDown(mx,my,pointerId) {
      if (mx>=ship.x-ship.w/2 && mx<=ship.x+ship.w/2 && my>=ship.y-ship.h/2 && my<=ship.y+ship.h/2) {
        startOnShip=true; canvas.setPointerCapture(pointerId);
      }
    }
    function handleMove(mx) { if(startOnShip){ isDragging=true; ship.x=mx; } }
    function handleUp() {
      if(startOnShip && !isDragging && !ball.active && !gameOver) { ball.active=true; ball.x=ship.x; ball.y=ship.y-ship.h/2; }
      isDragging=false; startOnShip=false;
    }
    canvas.addEventListener('pointerdown', e=>{ e.preventDefault(); handleDown(e.offsetX,e.offsetY,e.pointerId); });
    canvas.addEventListener('pointermove', e=>{ e.preventDefault(); handleMove(e.offsetX); });
    canvas.addEventListener('pointerup', e=>{ e.preventDefault(); handleUp(); canvas.releasePointerCapture(e.pointerId); });
    canvas.addEventListener('touchstart', e=>{ e.preventDefault(); const t=e.changedTouches[0]; handleDown(t.clientX,t.clientY); });
    canvas.addEventListener('touchmove', e=>{ e.preventDefault(); const t=e.changedTouches[0]; handleMove(t.clientX); });
    canvas.addEventListener('touchend', e=>{ e.preventDefault(); handleUp(); });

    // 初期表示
    resizeCanvas();
  </script>
</body>
</html>
